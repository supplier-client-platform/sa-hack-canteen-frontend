/*! angular-selector - v1.3.9 - https://github.com/indrimuska/angular-selector - (c) 2015 Indri Muska - MIT */
!function(a){var b,c,d,e,f,g={up:38,down:40,left:37,right:39,escape:27,enter:13,backspace:8,"delete":46,shift:16,leftCmd:91,rightCmd:93,ctrl:17,alt:18,tab:9},h=function(){function h(a){return a instanceof HTMLElement?a.ownerDocument&&a.ownerDocument.defaultView.opener?a.ownerDocument.defaultView.getComputedStyle(a):window.getComputedStyle(a):{}}function i(a,g,h,i,j){this.restrict="EAC",this.replace=!0,this.transclude=!0,this.scope={name:"@?",value:"=model",disabled:"=?disable",required:"=?require",multiple:"=?multi",placeholder:"@?",valueAttr:"@",labelAttr:"@?",groupAttr:"@?",options:"=?",create:"&?",rtl:"=?",api:"=?",change:"&?",remote:"&?",remoteParam:"@?",removeButton:"=?",softDelete:"=?",closeAfterSelection:"=?",viewItemTemplate:"=?",dropdownItemTemplate:"=?",dropdownCreateTemplate:"=?",dropdownGroupTemplate:"=?"},this.templateUrl="selector/selector.html",b=a,c=g,d=h,e=i,f=j}return i.prototype.$inject=["$filter","$timeout","$window","$http","$q"],i.prototype.link=function(i,j,k,l,m){m(i,function(i,l){var m=a.element(j[0].querySelector(".selector-input input")),n=a.element(j[0].querySelector(".selector-dropdown")),o=f.defer(),p={api:{},search:"",selectedValues:[],highlighted:0,valueAttr:null,labelAttr:"label",groupAttr:"group",options:[],remoteParam:"q",removeButton:!0,viewItemTemplate:"selector/item-default.html",dropdownItemTemplate:"selector/item-default.html",dropdownCreateTemplate:"selector/item-create.html",dropdownGroupTemplate:"selector/group-default.html"};a.isDefined(l.value)||(l.value=l.multiple?[]:""),a.forEach(p,function(b,c){a.isDefined(l[c])||(l[c]=b)}),a.forEach(["name","valueAttr","labelAttr"],function(a){k[a]||(k[a]=l[a])}),l.optionValue=function(a){return null==l.valueAttr?a:a[l.valueAttr]},l.optionEquals=function(b,c){return a.equals(l.optionValue(b),a.isDefined(c)?c:l.value)},l.setValue=function(a){l.multiple?l.value=null==l.valueAttr?a||[]:(a||[]).map(function(a){return a[l.valueAttr]}):l.value=null==l.valueAttr?a||{}:(a||{})[l.valueAttr]},l.hasValue=function(){return l.multiple?(l.value||[]).length>0:null==l.valueAttr?!a.equals({},l.value):!!l.value},l.fetch=function(){var b,c=l.search||"";if(!l.disabled){if(!a.isDefined(l.remote))throw"Remote attribute is not defined";if(l.loading=!0,l.options=[],b=l.remote({search:c}),"function"!=typeof b.then){var d={method:"GET",cache:!0,params:{}};a.extend(d,l.remote()),a.extend(d.params,l.remote().params),d.params[l.remoteParam]=c,b=e(d)}b.then(function(a){l.options=a.data||a,l.filterOptions(),l.loading=!1,o.resolve()},function(a){throw l.loading=!1,o.reject(),"Error while fetching data: "+(a.message||a)})}},a.isDefined(l.remote)||(l.remote=!1,o.resolve()),l.remote&&l.$watch("search",l.fetch),l.optionToObject=function(b,c){var d={},e=a.element(b);a.forEach(b.dataset,function(a,b){b.match(/^\$/)||(d[b]=a)}),b.value&&(d[l.valueAttr||"value"]=b.value),e.text()&&(d[l.labelAttr]=e.text().trim()),a.isDefined(c)&&(d[l.groupAttr]=c),l.options.push(d),!e.attr("selected")||!l.multiple&&l.hasValue()||(l.multiple?(l.value||(l.value=[]),l.value.push(l.optionValue(d))):l.value||(l.value=l.optionValue(d)))},l.fillWithHtml=function(){l.options=[],a.forEach(i,function(b){var c=(b.tagName||"").toLowerCase();"option"==c&&l.optionToObject(b),"optgroup"==c&&a.forEach(b.querySelectorAll("option"),function(a){l.optionToObject(a,(b.attributes.label||{}).value)})}),l.updateSelected()},l.initialize=function(){l.remote||a.isArray(l.options)&&l.options.length||l.fillWithHtml(),l.hasValue()&&(l.multiple?a.isArray(l.value)||(l.value=[l.value]):a.isArray(l.value)&&(l.value=l.value[0]),l.updateSelected(),l.filterOptions(),l.updateValue())},l.$watch("multiple",function(){c(l.setInputWidth),o.promise.then(l.initialize,l.initialize)}),l.dropdownPosition=function(){var a=m.parent()[0],b=h(a),c=parseFloat(b.marginTop||0),d=parseFloat(b.marginLeft||0);n.css({top:a.offsetTop+a.offsetHeight+c+"px",left:a.offsetLeft+d+"px",width:a.offsetWidth+"px"})},l.open=function(){l.isOpen=!0,l.dropdownPosition()},l.close=function(){l.isOpen=!1,l.resetInput()},l.decrementHighlighted=function(){l.highlight(l.highlighted-1),l.scrollToHighlighted()},l.incrementHighlighted=function(){l.highlight(l.highlighted+1),l.scrollToHighlighted()},l.highlight=function(a){k.create&&l.search&&-1==a?l.highlighted=-1:l.filteredOptions.length&&(l.highlighted=(l.filteredOptions.length+a)%l.filteredOptions.length)},l.scrollToHighlighted=function(){var a=n[0],b=a.querySelectorAll("li.selector-option")[l.highlighted],d=h(b),e=parseFloat(d.marginTop||0),f=parseFloat(d.marginBottom||0);l.filteredOptions.length&&(b.offsetTop+b.offsetHeight+f>a.scrollTop+a.offsetHeight&&c(function(){a.scrollTop=b.offsetTop+b.offsetHeight+f-a.offsetHeight}),b.offsetTop-e<a.scrollTop&&c(function(){a.scrollTop=b.offsetTop-e}))},l.createOption=function(b){f.when(function(){var c={};return a.isFunction(l.create)?c=l.create({input:b}):(c[l.labelAttr]=b,c[l.valueAttr||"value"]=b),c}()).then(function(a){l.options.push(a),l.set(a)})},l.set=function(b){a.isDefined(b)||(b=l.filteredOptions[l.highlighted]),l.multiple?l.selectedValues.indexOf(b)<0&&l.selectedValues.push(b):l.selectedValues=[b],(!l.multiple||l.closeAfterSelection)&&l.close(),l.resetInput()},l.unset=function(b){l.multiple?l.selectedValues.splice(a.isDefined(b)?b:l.selectedValues.length-1,1):l.selectedValues=[],l.resetInput()},l.keydown=function(a){switch(a.keyCode){case g.up:if(!l.isOpen)break;l.decrementHighlighted(),a.preventDefault();break;case g.down:l.isOpen?l.incrementHighlighted():l.open(),a.preventDefault();break;case g.escape:l.highlight(0),l.close();break;case g.enter:l.isOpen&&(k.create&&l.search&&-1==l.highlighted?l.createOption(a.target.value):l.filteredOptions.length&&l.set(),a.preventDefault());break;case g.backspace:if(!m.val()){var b=(l.selectedValues.slice(-1)[0]||{})[l.labelAttr]||"";l.unset(),l.open(),l.softDelete&&(l.search=b,l.multiple&&a.preventDefault())}break;case g.left:case g.right:case g.shift:case g.ctrl:case g.alt:case g.tab:case g.leftCmd:case g.rightCmd:break;default:!l.multiple&&l.hasValue()?a.preventDefault():(l.open(),l.highlight(0))}},l.inOptions=function(b,c){return l.remote?b.filter(function(b){return a.equals(c,b)}).length>0:b.indexOf(c)>=0},l.filterOptions=function(){l.filteredOptions=b("filter")(l.options||[],l.search),l.multiple&&(l.filteredOptions=l.filteredOptions.filter(function(b){var c=a.isArray(l.selectedValues)?l.selectedValues:[l.selectedValues];return!l.inOptions(c,b)})),l.highlighted>=l.filteredOptions.length&&l.highlight(l.filteredOptions.length-1),-1==l.highlighted&&l.filteredOptions.length>0&&l.highlight(0)},l.measureWidth=function(){var b,c=h(m[0]),d=a.element('<span class="selector-shadow"></span>');return d.text(m.val()||(l.hasValue()?"":l.placeholder)||""),a.element(document.body).append(d),a.forEach(["fontFamily","fontSize","fontWeight","fontStyle","letterSpacing","textTransform","wordSpacing","textIndent"],function(a){d.css(a,c[a])}),b=d[0].offsetWidth,d.remove(),b},l.setInputWidth=function(){var a=l.measureWidth()+1;m.css("width",a+"px")},l.resetInput=function(){m.val(""),l.search="",l.setInputWidth()},l.$watch("[search, options, value]",function(){l.filterOptions(),c(function(){l.setInputWidth(),l.isOpen&&l.dropdownPosition()})},!0),l.updateValue=function(b){a.isDefined(b)||(b=l.selectedValues),l.setValue(l.multiple?b:b[0])},l.$watch("selectedValues",function(b,c){a.equals(b,c)||(l.updateValue(),a.isFunction(l.change)&&l.change(l.multiple?{newValue:b,oldValue:c}:{newValue:b[0],oldValue:c[0]}))},!0),l.$watchCollection("options",function(b,c){a.equals(b,c)||l.remote||l.updateSelected()}),l.updateSelected=function(){l.multiple?l.selectedValues=(l.value||[]).map(function(a){return b("filter")(l.options,function(b){return l.optionEquals(b,a)})[0]}).filter(function(b){return a.isDefined(b)}):l.selectedValues=(l.options||[]).filter(function(a){return l.optionEquals(a)}).slice(0,1)},l.$watch("value",function(b,c){a.equals(b,c)||((!l.remote||l.options.length>0)&&l.updateSelected(),l.filterOptions(),l.updateValue())},!0),m=a.element(j[0].querySelector(".selector-input input")).on("focus",function(){c(function(){l.$apply(l.open)})}).on("blur",function(){l.$apply(l.close)}).on("keydown",function(a){l.$apply(function(){l.keydown(a)})}).on("input",function(){l.setInputWidth()}),n.on("mousedown",function(a){a.preventDefault()}),a.element(d).on("resize",function(){l.dropdownPosition()}),a.forEach(["open","close","fetch"],function(a){l.api[a]=l[a]}),l.api.focus=function(){m[0].focus()},l.api.set=function(b){var c=(l.filteredOptions||[]).filter(function(a){return l.optionEquals(a,b)});a.forEach(c,function(a){l.set(a)})},l.api.unset=function(b){var c=b?(l.selectedValues||[]).filter(function(a){return l.optionEquals(a,b)}):l.selectedValues,d=l.selectedValues.map(function(a,b){return l.inOptions(c,a)?b:-1}).filter(function(a){return a>=0});a.forEach(d,function(a,b){l.unset(a-b)})}})},i}();a.module("selector",[]).run(["$templateCache",function(a){a.put("selector/selector.html",'<div class="selector-container" ng-attr-dir="{{rtl ? \'rtl\' : \'ltr\'}}" ng-class="{open: isOpen, empty: !filteredOptions.length && (!create || !search), multiple: multiple, \'has-value\': hasValue(), rtl: rtl, loading: loading, \'remove-button\': removeButton, disabled: disabled}"><select name="{{name}}" ng-hide="true" ng-model="selectedValues" multiple ng-options="option as option[labelAttr] for option in selectedValues" ng-hide="true"></select><label class="selector-input"><ul class="selector-values"><li ng-repeat="(index, option) in selectedValues track by index"><div ng-include="viewItemTemplate"></div><div ng-if="multiple" class="selector-helper" ng-click="!disabled && unset(index)"><span class="selector-icon"></span></div></li></ul><input ng-model="search" placeholder="{{!hasValue() ? placeholder : \'\'}}" ng-disabled="disabled" ng-required="required && !hasValue()"><div ng-if="!multiple || loading" class="selector-helper selector-global-helper" ng-click="!disabled && removeButton && unset()"><span class="selector-icon"></span></div></label><ul class="selector-dropdown" ng-show="filteredOptions.length > 0 || (create && search)"><li class="selector-option create" ng-class="{active: highlighted == -1}" ng-if="create && search" ng-include="dropdownCreateTemplate" ng-mouseover="highlight(-1)" ng-click="createOption(search)"></li><li ng-repeat-start="(index, option) in filteredOptions track by index" class="selector-optgroup" ng-include="dropdownGroupTemplate" ng-show="option[groupAttr] && index == 0 || filteredOptions[index-1][groupAttr] != option[groupAttr]"></li><li ng-repeat-end ng-class="{active: highlighted == index, grouped: option[groupAttr]}" class="selector-option" ng-include="dropdownItemTemplate" ng-mouseover="highlight(index)" ng-click="set()"></li></ul></div>'),a.put("selector/item-create.html",'Add <i ng-bind="search"></i>'),a.put("selector/item-default.html",'<span ng-bind="option[labelAttr] || option"></span>'),a.put("selector/group-default.html",'<span ng-bind="option[groupAttr]"></span>')}]).directive("selector",["$filter","$timeout","$window","$http","$q",function(a,b,c,d,e){return new h(a,b,c,d,e)}])}(window.angular);