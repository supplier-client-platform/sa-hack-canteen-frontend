"use strict";!function(){function a(a,b){return(b.getTime()-a.getTime())/c}var b=angular.module("angularBasicAuth",["LocalStorageModule","base64"]),c=6e4;b.constant("MODULE_VERSION","0.0.0"),b.value("authDefaults",{authenticateUrl:"/api/authenticate",sessionMinutes:180}),b.factory("authInterceptor",["$q","authService",function(a,b){var c=b.isEndpoint,d={request:function(a){if(c(a.url)){var d=b.getAuth(),e=b.headers;if(d){a.headers.Authorization=d;for(var f in e)e.hasOwnProperty(f)&&(a.headers[f]=e[f])}}return a},responseError:function(c){return 401===c.status&&b.handleAuthFailure(),a.reject(c)}};return d}]),function(){b.factory("authService",["$log","localStorageService","$base64","$q","$rootScope","$interval","authDefaults",function(b,c,d,e,f,g,h){function i(a){for(var b=0,c=s.length;c>b;b++)if(a===s[b])return!0;return!1}function j(){b.debug("logout event"),c.remove(q),c.remove(r),c.remove(p),f.$emit("logout")}function k(a,e){b.debug("Setting credentials for user: "+a),c.set(p,a),c.set(q,"Basic "+d.encode(a+":"+e)),l()}function l(){c.set(r,(new Date).toString())}function m(){var b=c.get(r)||"";return""===b?!1:a(new Date(b),new Date)<h.sessionMinutes}function n(){m()||(b.debug("Authentication credentials missing or out of date"),j())}function o(){return c.get(q)}b.debug("authService constructed");var p="username",q="auth",r="last-activity",s=[],t=document.createElement("a");return n(),g(n,6e4),{getAuth:o,logout:j,activity:l,addEndpoint:function(a){a=a||window.location,t.href=a;var b=t.hostname;i(b)||s.push(b)},headers:{},isEndpoint:function(a){t.href=a;var b=t.hostname;return i(b)},username:function(){return n(),c.get(p)},handleAuthFailure:function(){j(),f.$emit("authentication-failure")},login:function(a,c){function d(){200!==this.status?g.reject():g.resolve()}b.debug("login event"),k(a,c);var g=e.defer(),i=g.promise,l=new XMLHttpRequest;l.onload=d,l.open("GET",h.authenticateUrl),l.setRequestHeader("Accept","application/json"),l.setRequestHeader("Authorization",o());for(var m in this.headers)this.headers.hasOwnProperty(m)&&l.setRequestHeader(m,this.headers[m]);return l.send(null),i.success=function(a){return i.then(function(){a()}),i},i.error=function(a){return i.then(null,function(){a()}),i},i.then(function(){b.debug("Successfully authenticated"),f.$broadcast("login",a)},function(){b.debug("Test authentication failed"),j(),f.$broadcast("authentication-failed",a)}),i}}}])}(),b.config(["$httpProvider",function(a){a.interceptors.push("authInterceptor")}])}();